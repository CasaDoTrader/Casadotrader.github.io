<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortaleza - O Jogo</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>body{margin:0;padding:0}#mapa{height:100vh;width:100%}.action-button,.whatsapp-button{display:block;margin-top:5px;padding:8px 12px;color:#fff;border:none;border-radius:4px;cursor:pointer;width:100%;text-align:center;font-weight:700}.action-button{background-color:#007bff}.withdrawal-section{padding:10px 0;border-top:1px dashed #ccc;margin-top:10px}.withdrawal-section input{width:100%;padding:5px;box-sizing:border-box;margin-bottom:5px}.withdrawal-button{background-color:#28a745}.whatsapp-button{background-color:#25D366;text-decoration:none;color:#fff!important;margin-top:15px;display:block;pointer-events:auto}.whatsapp-button.disabled{background-color:#7f7f7f;cursor:not-allowed;pointer-events:none}.exchange-button.cr-to-pix{background-color:#dc3545}.exchange-button.pix-to-cr{background-color:#17a2b8}.action-button:disabled,.exchange-button:disabled{background-color:#6c757d;cursor:not-allowed}.inventory-content{font-family:sans-serif;line-height:1.4}.inventory-list{font-size:.9em;line-height:1.3;margin-top:5px;max-height:100px;overflow-y:auto;padding-left:15px;border-top:1px solid #eee;padding-top:5px}.leaflet-popup-content-wrapper{max-width:200px}.validation-button{background-color:#ffc107;color:#000}.sell-button{background-color:#dc3545}.harvest-button{background-color:#17a2b8}.timer-display{font-weight:700;color:#007bff;margin:5px 0}.timer-display.ready{color:#28a745}.money-cr{color:#007bff}.money-pix{color:#28a745}</style>
</head>
<body>
    <div id="mapa"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
    // VARIAVEIS INICIAIS (VALORES PADRÃO)
    let playerMoney = 0.00,
        playerPix = 0.00,
        withdrawalHistory = [],
        playerInventory = {
            riceSeeds: 100,
            harvestedRice: 0,
            plantedSeeds: 0
        },
        farmPlots = 1, // Espaços de plantio fixos
        harvestReady = true,
        remainingTime = 0,
        farmMarker, homeMarker, map, harvestTimerInterval;

    // --- VARIÁVEIS DE CONFIGURAÇÃO ATUALIZADAS ---
    const CRUZEIRO_SYMBOL = "Cr$",
        PIX_SYMBOL = "R$",
        // REMOVIDA: EXCHANGE_TAX_CR_TO_PIX = 0.10,
        CRUZEIRO_TO_PIX_RATE = 0.01, // 1 Cr$ = 0.01 R$
        OPERATOR_WHATSAPP_NUMBER = "5585999522997",
        MIN_WITHDRAWAL_AMOUNT = 0.01,
        MIN_CR_TO_PIX_EXCHANGE = 1.00, // NOVO: Mínimo de 1 Cruzeiro para troca.
        HARVEST_TIME_SECONDS = 60,
        RICE_SEED_PRICE_UNIT = 0.01,
        RICE_SELL_PRICE = 0.01;

    // --- FUNÇÕES DE SAVE/LOAD (localStorage) ---
    function saveGame() {
        const gameState = {
            money: playerMoney,
            pix: playerPix,
            inventory: playerInventory,
            plots: farmPlots,
            history: withdrawalHistory,
            ready: harvestReady,
            time: remainingTime
        };
        localStorage.setItem('fortalezaGameSave', JSON.stringify(gameState));
    }

    function loadGame() {
        const savedState = localStorage.getItem('fortalezaGameSave');
        if (savedState) {
            try {
                const gameState = JSON.parse(savedState);
                playerMoney = gameState.money || 0.00;
                playerPix = gameState.pix || 0.00;
                playerInventory = gameState.inventory || {
                    riceSeeds: 100,
                    harvestedRice: 0,
                    plantedSeeds: 0
                };
                farmPlots = gameState.plots || 1;
                withdrawalHistory = gameState.history || [];
                harvestReady = gameState.ready || true;
                remainingTime = gameState.time || 0;
                
                // Se houver tempo restante, reinicia o timer
                if (remainingTime > 0 && playerInventory.plantedSeeds > 0) {
                    startHarvestTimer(true); // Passa 'true' para não resetar o tempo
                }
                return true;
            } catch (e) {
                // Se falhar (save corrompido), remove o save e inicia do zero para evitar tela branca
                console.error("Save corrompido detectado e removido.", e);
                localStorage.removeItem('fortalezaGameSave');
                return false;
            }
        }
        return false;
    }
    // --- FIM FUNÇÕES DE SAVE/LOAD ---


    function formatCurrency(e) {
        return e.toFixed(2).replace(".", ",")
    }

    function updateMoneyDisplay() {
        farmMarker && farmMarker.getPopup().isOpen() && (farmMarker.setPopupContent(getFarmPopupContent()), attachFarmEventListeners());
        homeMarker && homeMarker.getPopup().isOpen() && homeMarker.setPopupContent(getHomePopupContent());
        updateHomeMarkerState();
        
        // Salva o jogo toda vez que o display é atualizado
        saveGame(); 
    }

    function generateUniqueTransactionId() {
        let e;
        for (;;) {
            if (e = Math.random().toString(36).substring(2, 10).toUpperCase(), !withdrawalHistory.some(t => t.id === e)) return e
        }
    }

    function getInventoryContent() {
        let e = "",
            t = !1;
        return playerInventory.riceSeeds > 0 && (e += `<li style="color:#008000;">**${playerInventory.riceSeeds}x** Semente de Arroz</li>`, t = !0), playerInventory.harvestedRice > 0 && (e += `<li style="color:#dc3545;">**${playerInventory.harvestedRice}x** Arroz Colhido</li>`, t = !0), playerInventory.plantedSeeds > 0 && (e += `<li style="color:#f7922d;">**${playerInventory.plantedSeeds}** Espaço(s) Plantado(s)</li>`, t = !0), withdrawalHistory.forEach(t => {
            const n = t.validated ? '<span style="color:green;"> (Validado)</span>' : '<span style="color:red;"> (Pendente)</span>';
            e += `<li>Saque: **R$ ${formatCurrency(t.amount)}** (ID: ${t.id})${n}</li>`
        }), t || (e = '<li style="list-style:none;font-style:italic;color:#6c757d;padding-left:0;">Inventário vazio.</li>'), `<div class="inventory-content"><span style="font-size:1.1em;display:block;margin-bottom:5px;">SALDO</span>Cr$: <span class="money-cr">${formatCurrency(playerMoney)}</span> (Cruzeiro)<br>R$: <span class="money-pix">${formatCurrency(playerPix)}</span> (PIX)<div style="margin-top:10px;font-weight:bold;">Itens:</div><ul class="inventory-list">${e}</ul></div>`
    }

    function getHomePopupContent() {
        return `<b>Casa do Jogador</b><hr style="margin:5px 0;">${getInventoryContent()}`
    }

    function startHarvestTimer(resume = false) {
        if (0 !== playerInventory.plantedSeeds) {
            harvestReady = !1;
            if (!resume) {
                remainingTime = HARVEST_TIME_SECONDS;
            }
            updateMoneyDisplay();
            
            if (harvestTimerInterval) {
                clearInterval(harvestTimerInterval);
            }
            
            harvestTimerInterval = setInterval(() => {
                remainingTime--;
                updateMoneyDisplay();
                if (remainingTime <= 0) {
                    clearInterval(harvestTimerInterval);
                    harvestReady = !0;
                    remainingTime = 0;
                    updateMoneyDisplay();
                    farmMarker && farmMarker.getPopup().isOpen() && alert("Colheita Pronta! Seu arroz amadureceu.")
                }
            }, 1e3)
        }
    }
    
    // Funções do jogo

    // FUNÇÃO DE SAQUE
    window.requestWithdrawal = function() {
        const e = document.getElementById("withdrawal-amount"),
            t = parseFloat(parseFloat(e.value).toFixed(2));
        if (isNaN(t) || t < MIN_WITHDRAWAL_AMOUNT) return void alert(`Valor inválido. O saque mínimo é R$ ${formatCurrency(MIN_WITHDRAWAL_AMOUNT)}.`);
        if (t > playerPix) return void alert(`Saldo Pix insuficiente. Saldo atual: R$ ${formatCurrency(playerPix)}.`);
        playerPix -= t;
        const n = generateUniqueTransactionId();
        withdrawalHistory.push({
            id: n,
            amount: t,
            validated: !1
        }), updateMoneyDisplay(), e.value = "", alert(`Saque de R$ ${formatCurrency(t)} solicitado. ID ${n} adicionado. Vá até a Lotérica para validar.`)
    };

    // FUNÇÃO DE TROCA ATUALIZADA (REMOVIDA A TAXA E APLICADO O MÍNIMO DE 1 CR$)
    window.requestExchange = function(type) {
        if ("cr-to-pix" === type) {
            const inputElement = document.getElementById("input-cr-to-pix");
            const amountToExchange = parseFloat(parseFloat(inputElement.value).toFixed(2));

            if (isNaN(amountToExchange) || amountToExchange < MIN_CR_TO_PIX_EXCHANGE) {
                return alert(`Por favor, insira um valor válido de Cr$ para trocar (mínimo Cr$ ${formatCurrency(MIN_CR_TO_PIX_EXCHANGE)}).`);
            }
            
            if (playerMoney < amountToExchange) {
                return alert(`Saldo insuficiente. Você precisa de ${CRUZEIRO_SYMBOL} ${formatCurrency(amountToExchange)}.`);
            }

            // Cálculo da troca: Valor * Taxa de Câmbio (SEM TAXA DE IMPOSTO)
            const pixReceived = amountToExchange * CRUZEIRO_TO_PIX_RATE;
            
            playerMoney -= amountToExchange;
            playerPix += pixReceived;
            
            alert(`Troca de ${CRUZEIRO_SYMBOL} ${formatCurrency(amountToExchange)} por ${PIX_SYMBOL} ${formatCurrency(pixReceived)}.`);
            inputElement.value = ''; // Limpa o campo
            
        } else if ("pix-to-cr" === type) {
            const inputElement = document.getElementById("input-pix-to-cr");
            const amountToExchange = parseFloat(parseFloat(inputElement.value).toFixed(2));

            if (isNaN(amountToExchange) || amountToExchange <= 0.01) {
                return alert("Por favor, insira um valor válido de R$ PIX para trocar.");
            }
            
            if (playerPix < amountToExchange) {
                return alert(`Saldo insuficiente. Você precisa de ${PIX_SYMBOL} ${formatCurrency(amountToExchange)}.`);
            }

            // Cálculo da troca: Valor / Taxa de Câmbio
            const crReceived = amountToExchange / CRUZEIRO_TO_PIX_RATE;
            
            playerPix -= amountToExchange;
            playerMoney += crReceived;
            
            alert(`Troca de ${PIX_SYMBOL} ${formatCurrency(amountToExchange)} por ${CRUZEIRO_SYMBOL} ${formatCurrency(crReceived)}.`);
            inputElement.value = ''; // Limpa o campo
        }
        updateMoneyDisplay();
    };

    // FUNÇÃO DE COMPRA DE SEMENTES
    window.buyRiceSeeds = function() {
        const quantityInput = document.getElementById("seed-quantity-input");
        const quantity = parseInt(quantityInput.value, 10);

        if (isNaN(quantity) || quantity <= 0) {
            return void alert("Por favor, digite uma quantidade válida de sementes.");
        }

        const cost = quantity * RICE_SEED_PRICE_UNIT;

        if (playerMoney < cost) {
            return void alert(`Saldo insuficiente. Você precisa de ${CRUZEIRO_SYMBOL} ${formatCurrency(cost)} para comprar ${quantity} sementes.`);
        }

        playerMoney -= cost;
        playerInventory.riceSeeds += quantity;
        quantityInput.value = ""; 

        alert(`Comprou ${quantity} Sementes de Arroz por ${CRUZEIRO_SYMBOL} ${formatCurrency(cost)}.`);
        updateMoneyDisplay();
    };


    window.sellRice = function() {
        const e = RICE_SELL_PRICE;
        if (playerInventory.harvestedRice <= 0) return void alert("Você não tem Arroz colhido para vender.");
        const t = playerInventory.harvestedRice * e,
            n = playerInventory.harvestedRice;
        playerMoney += t, playerInventory.harvestedRice = 0, alert(`Vendeu ${n} Arroz Colhido por ${CRUZEIRO_SYMBOL} ${formatCurrency(t)}.`), updateMoneyDisplay()
    };

    window.plantSeed = function() {
        if (!harvestReady) return void alert("Aguarde a colheita anterior amadurecer!");
        if (playerInventory.plantedSeeds >= farmPlots) return void alert(`Todos os ${farmPlots} espaços estão ocupados. Você precisa colher primeiro.`);
        if (playerInventory.riceSeeds <= 0) return void alert("Você não tem sementes de arroz para plantar. Compre na Agro Cearense.");
        playerInventory.riceSeeds -= 1, playerInventory.plantedSeeds += 1, startHarvestTimer(), alert("1 semente de arroz plantada com sucesso! O cronômetro de crescimento iniciou."), updateMoneyDisplay()
    };

    window.harvest = function() {
        if (playerInventory.plantedSeeds <= 0) return void alert("Não há nada plantado para colher.");
        if (!harvestReady) return void alert(`Aguarde ${remainingTime} segundos para colher.`);
        const e = playerInventory.plantedSeeds,
            t = Math.floor(5 * Math.random()) + 5,
            n = e * t;
        playerInventory.harvestedRice += n, playerInventory.plantedSeeds = 0, harvestReady = !0, remainingTime = 0, alert(`Colheita concluída! Você colheu ${n} Arroz Colhido (${t} por espaço) de ${e} espaço(s).`), updateMoneyDisplay()
    };

    function updateWhatsappLink(e) {
        const t = document.getElementById("whatsapp-loterica-button");
        if (t) {
            if (!e || !e.validated) return t.classList.add("disabled"), t.textContent = "FINALIZAR SAQUE (WhatsApp)", void(t.href = "#");
            const n = e.id,
                o = formatCurrency(e.amount),
                a = encodeURIComponent(`Olá, sou o jogador e gostaria de finalizar meu saque.\n\n*ID de Transação Validado (Lotérica):* ${n}\n*Valor a Receber (Confirmado):* R$ ${o}\n\n*Minha Chave Pix (aqui o jogador digita/cola a chave):*`);
            t.href = `https://wa.me/${OPERATOR_WHATSAPP_NUMBER}?text=${a}`, t.classList.remove("disabled"), t.textContent = `FINALIZAR SAQUE R$ ${o} (Cód. ${n})`
        }
    }

    window.validateWithdrawalCode = function() {
        const e = document.getElementById("loterica-code-input"),
            t = e.value.trim().toUpperCase();
        if (updateWhatsappLink(null), !t) return void alert("Por favor, digite o código.");
        const n = withdrawalHistory.find(e => e.id === t);
        n ? n.validated ? (updateWhatsappLink(n), alert(`O código ${t} já foi validado. Finalize a transação pelo WhatsApp.`)) : (n.validated = !0, updateMoneyDisplay(), updateWhatsappLink(n), alert(`Código ${t} validado com sucesso! Use o botão do WhatsApp para enviar seus dados Pix ao operador.`)) : alert("ERRO: Código de transação não encontrado.")
    };

    const FORTALEZA_COORDS = [-3.7319, -38.5267],
        BCB_COORDS = [-3.7341, -38.5273],
        TOURSTAR_COORDS = [-3.7268, -38.498],
        LOTERICA_COORDS = [-3.7386571, -38.4852458],
        AGRO_CEARENSE_COORDS = [-3.7993489, -38.5071345],
        FAZENDA_COORDS = [-3.8115, -38.563],
        CASA_COORDS = [-3.82, -38.57],
        HORTIFRUTI_COORDS = [-3.753, -38.568],
        iconBase = "https://cdn-icons-png.flaticon.com/512/",
        bankIcon = L.icon({
            iconUrl: iconBase + "3673/3673419.png",
            iconSize: [38, 38],
            iconAnchor: [19, 38],
            popupAnchor: [0, -30]
        }),
        exchangeIcon = L.icon({
            iconUrl: iconBase + "3238/3238479.png",
            iconSize: [38, 38],
            iconAnchor: [19, 38],
            popupAnchor: [0, -30]
        }),
        lotteryIcon = L.icon({
            iconUrl: iconBase + "3673/3673385.png",
            iconSize: [38, 38],
            iconAnchor: [19, 38],
            popupAnchor: [0, -30]
        }),
        seedIcon = L.icon({
            iconUrl: iconBase + "3067/3067167.png",
            iconSize: [38, 38],
            iconAnchor: [19, 38],
            popupAnchor: [0, -30]
        }),
        farmIcon = L.icon({
            iconUrl: iconBase + "2857/2857508.png",
            iconSize: [45, 45],
            iconAnchor: [22, 45],
            popupAnchor: [0, -40]
        }),
        marketIcon = L.icon({
            iconUrl: iconBase + "3075/3075841.png",
            iconSize: [38, 38],
            iconAnchor: [19, 38],
            popupAnchor: [0, -30]
        }),
        homeIcon = L.icon({
            iconUrl: iconBase + "9404/9404760.png",
            iconSize: [38, 38],
            iconAnchor: [19, 38],
            popupAnchor: [0, -30]
        });

    function updateHomeMarkerState() {
        !homeMarker && map && (homeMarker = L.marker(CASA_COORDS, {
            icon: homeIcon
        }).addTo(map).bindPopup(getHomePopupContent()), homeMarker.on("popupopen", function() {
            homeMarker.getPopup().setContent(getHomePopupContent())
        }))
    }

    function getFarmPopupContent() {
        let e = `Espaços Ocupados: **${playerInventory.plantedSeeds} / ${farmPlots}**`; 
        e += `<span style="color:${playerInventory.plantedSeeds<farmPlots?"#28a745":"red"}; display:block;">(Total de Espaços: ${farmPlots})</span>`;
        
        let n = "";
        playerInventory.plantedSeeds > 0 && !harvestReady ? n = `<p class="timer-display">Tempo para Colher: ${remainingTime}s</p>` : playerInventory.plantedSeeds > 0 && harvestReady && (n = '<p class="timer-display ready">PRONTO PARA COLHEITA!</p>');
        let o = !harvestReady || playerInventory.plantedSeeds <= 0,
            a = !harvestReady || 0 === playerInventory.riceSeeds || playerInventory.plantedSeeds >= farmPlots;
        
        return `<b>Fazenda de Arroz (Sua Propriedade)</b><hr style="margin:5px 0;"><p style="font-size:1.1em;font-weight:700;margin:5px 0;color:#008000;">${e}</p>${n}<button class="action-button" id="plant-seed-button" style="background-color:${a?"#6c757d":"#008000"};" ${a?"disabled":""}>PLANTAR SEMENTE DE ARROZ (${playerInventory.riceSeeds} no estoque)</button><button class="action-button harvest-button" id="harvest-button" style="background-color:${o?"#6c757d":"#17a2b8"};" ${o?"disabled":""}>COLHER ARROZ (${playerInventory.plantedSeeds} plantado(s))</button>`
    }

    function attachFarmEventListeners() {
        const t = document.getElementById("plant-seed-button"),
            n = document.getElementById("harvest-button");
        t && (t.onclick = window.plantSeed), n && (n.onclick = window.harvest)
    }

    // Opcional: Salva o jogo se o jogador tentar fechar a página
    window.addEventListener('beforeunload', saveGame);

    window.onload = function() {
        // Carrega o jogo salvo (ou inicia novo se falhar)
        loadGame();
        
        map = L.map("mapa").setView(FORTALEZA_COORDS, 13), L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 19,
            attribution: "&copy; OpenStreetMap"
        }).addTo(map), map.invalidateSize();
        
        // BANCO CENTRAL (BCB)
        L.marker(BCB_COORDS, {
            icon: bankIcon
        }).addTo(map).bindPopup('<b>Banco Central do Brasil (BCB)</b><hr style="margin:5px 0;"><div class="withdrawal-section" style="border:none;margin-top:0;"><span style="font-weight:700;color:#28a745;display:block;margin-bottom:5px;">Solicitar Saque Pix (Mín: R$ 0,01)</span><input type="number" id="withdrawal-amount" placeholder="Valor em R$" min="0.01" step="0.01"><button class="action-button withdrawal-button" onclick="requestWithdrawal()">Gerar ID de Saque</button></div>');
        
        // TOURSTAR CÂMBIO - CONTEÚDO ATUALIZADO
        const e = L.marker(TOURSTAR_COORDS, {
            icon: exchangeIcon
        }).addTo(map).bindPopup(`
            <b>TourStar Câmbio</b>
            <hr style="margin:5px 0;">
            
            <div style="margin-bottom:10px; padding: 5px; border: 1px solid #dc3545; border-radius: 4px;">
                <span style="font-weight:700; color:#dc3545;">Cr$ -> R$ PIX (Câmbio: ${CRUZEIRO_SYMBOL} 1 = ${PIX_SYMBOL} ${formatCurrency(CRUZEIRO_TO_PIX_RATE)})</span>
                <span style="font-size:0.9em; display:block; color:#dc3545;">(Mínimo: ${CRUZEIRO_SYMBOL} ${formatCurrency(MIN_CR_TO_PIX_EXCHANGE)} | Sem Taxa)</span>
                <input type="number" id="input-cr-to-pix" placeholder="Valor em Cruzeiros (Cr$)" min="${MIN_CR_TO_PIX_EXCHANGE}" step="0.01" style="width:100%;padding:5px;box-sizing:border-box;margin-top:5px;">
                <button id="exchange-cr-to-pix" class="action-button exchange-button cr-to-pix" onclick="requestExchange('cr-to-pix')">TROCAR</button>
            </div>
            
            <div style="padding: 5px; border: 1px solid #17a2b8; border-radius: 4px;">
                <span style="font-weight:700; color:#17a2b8;">R$ PIX -> Cr$ (Câmbio: ${PIX_SYMBOL} 1 = ${CRUZEIRO_SYMBOL} ${formatCurrency(1 / CRUZEIRO_TO_PIX_RATE)})</span>
                <span style="font-size:0.9em; display:block; color:#17a2b8;">(Sem Taxa)</span>
                <input type="number" id="input-pix-to-cr" placeholder="Valor em PIX (R$)" min="0.01" step="0.01" style="width:100%;padding:5px;box-sizing:border-box;margin-top:5px;">
                <button id="exchange-pix-to-cr" class="action-button exchange-button pix-to-cr" onclick="requestExchange('pix-to-cr')">TROCAR</button>
            </div>
        `);
        
        // LOTERIA POPULAR
        L.marker(LOTERICA_COORDS, {
            icon: lotteryIcon
        }).addTo(map).bindPopup('<b>Loteria Popular</b><hr style="margin:5px 0;"><p style="font-size:.9em;">1. Insira o ID para validar:</p><input type="text" id="loterica-code-input" placeholder="Ex: A1B2C3D4" style="width:100%;padding:5px;box-sizing:border-box;text-transform:uppercase;"><button class="action-button validation-button" onclick="validateWithdrawalCode()">Validar Código</button><p style="font-size:.9em;margin-top:15px;">2. Após a validação, finalize:</p><a id="whatsapp-loterica-button" href="#" target="_blank" class="whatsapp-button disabled">FINALIZAR SAQUE (WhatsApp)</a>');
        
        // AGRO CEARENSE
        const t = `<b>Agro Cearense - Sementes</b><hr style="margin:5px 0;"><p style="margin:5px 0;font-weight:700;color:green;">Preço Unitário: Cr$ ${formatCurrency(RICE_SEED_PRICE_UNIT)}</p>
                    <input type="number" id="seed-quantity-input" placeholder="Qtd. de Sementes" min="1" step="1" style="width:100%;padding:5px;box-sizing:border-box;margin-bottom:5px;">
                    <button class="action-button withdrawal-button" id="buy-seed-button" style="background-color:#008000;">COMPRAR SEMENTES</button>`,
            n = L.marker(AGRO_CEARENSE_COORDS, {
                icon: seedIcon
            }).addTo(map).bindPopup(t);
        n.on("popupopen", function() {
            document.getElementById("buy-seed-button").onclick = window.buyRiceSeeds
        });
        
        // HORTIFRUTI
        const o = L.marker(HORTIFRUTI_COORDS, {
            icon: marketIcon
        }).addTo(map).bindPopup(`<b>Hortifruti do Carlinhos</b><hr style="margin:5px 0;"><p style="margin:5px 0;font-weight:700;color:#dc3545;">Venda: Cr$ ${formatCurrency(RICE_SELL_PRICE)} por Arroz Colhido</p><button id="sell-rice-button" class="action-button sell-button">VENDER TODO O ARROZ</button>`);
        o.on("popupopen", function() {
            document.getElementById("sell-rice-button").onclick = window.sellRice
        }), 
        
        // FAZENDA
        farmMarker = L.marker(FAZENDA_COORDS, {
            icon: farmIcon
        }).addTo(map).bindPopup(getFarmPopupContent()), farmMarker.on("popupopen", function() {
            farmMarker.getPopup().setContent(getFarmPopupContent()), attachFarmEventListeners()
        }), updateMoneyDisplay(), updateWhatsappLink(null)
    };
    </script>
</body>
</html>